<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>
        </title>
        <script type="text/javascript" charset="utf8" src="phonegap.js"></script>
        <script type="text/javascript" charset="utf8" src="js/app.js"></script>
        <link rel="stylesheet" href="css/jquery.mobile-1.1.0.min.css" />
        <link rel="stylesheet" href="css/style.css" />
        <script src="js/jquery.min.js">
        </script>
        <script src="js/jquery.mobile-1.1.0.min.js">
        </script>



<script type="text/javascript">


$(document).ready(function() {
    function sendImage(src) {
        
        // Set the image source [library || camera]
        src = (src == 'library') ? Camera.PictureSourceType.PHOTOLIBRARY : Camera.PictureSourceType.CAMERA;
        
        // Aquire the image -> Phonegap API
        navigator.camera.getPicture(success, fail, {quality: 45, sourceType: src, destinationType: 0});
        
        // Successfully aquired image data -> base64 encoded string of the image file
        function success(imageData) {
            
            var url = 'http://litio.net/chancla/sube.php';
            var params = {image: imageData};
            $('#image').attr('src', 'data:image/jpeg;base64,' + params['image']);
            
            // send the data
            //$.post(url, params, function(data) {

                var file = {
                    file: params['image'],
                    filename: "my_cool_image.jpg"
                };

                var jqxhr = $.ajax({
                    url: "http://michancla.es/rest/file.json",
                    type: 'POST',
                    dataType: 'json',
                    //data: JSON.stringify(obj),
                    data: file,
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert('No internet connection? Check your settings');
                        console.log(JSON.stringify(XMLHttpRequest));
                        console.log(JSON.stringify(textStatus));
                        console.log(JSON.stringify(errorThrown));
                    },
                    success: function (data) {
                        alert("siip");
                        //console.log(JSON.stringify(data));
                        $.mobile.changePage( $("#chancla_details"), { transition: "slideup"} );
                    }
                });
                
                // Display the selected image on send complete
  
            //});
        }
        
        function fail(message) { alert(message); }
    }

    function filechanged(){

        console.log(this);
    }

    function testImage() {


        //alert("You have been logged out.");
            //$.mobile.loading( 'show', { text: "uploading photo" });
            //$.mobile.loading( 'show' );
            //$.mobile.changePage( $("#chancla_details"), { transition: "slideup"} );



  try {

var obj={
    node:{
      title: 'Siiiiii',
      type:'chancla', //Whatever your content type is..
      status: 1,
      /*language:'en', //this attribute is optional, en for english
      body: { 
        und: [
        {value:'sdasdasd', format:'full_html'} //This is the body, if you have other fields its supposed to be similar, just body would be the field name
        ]
      } */
    }
  };

    var jqxhr = $.ajax({
      url: "http://michancla.es/rest/node.json",
      type: 'POST',
      dataType: 'json',
      //data: JSON.stringify(obj),
      data: "node[type]=chancla&node[title]=Holaaaa&node[language]=''&node[field_test][und][0][value]=your values",
      error: function (XMLHttpRequest, textStatus, errorThrown) {
        alert('No internet connection? Check your settings');
        console.log(JSON.stringify(XMLHttpRequest));
        console.log(JSON.stringify(textStatus));
        console.log(JSON.stringify(errorThrown));
      },
      success: function (data) {







            alert("siip");
          console.log(JSON.stringify(data));
      }
    });
  }
  catch (error) { alert("We encountered an error - " + error); }



    }
    
    $('.send-image').click(function () { sendImage($(this).val()); }); 
    $('.test').click(function () { testImage(); }); 
    $('.filefield').change(function () { upFoto(); }); 
});



function upFoto(){
//console.log($('.filefield').attr("files")[0]);

                var file = {
                    file: "hjghgkhghgjhghjghghjkasdadfsadsf".toString('base64'),
                    filename: "my_cool_image.jpg"
                };

                var jqxhr = $.ajax({
                    url: "http://michancla.es/rest/file.json",
                    type: 'POST',
                    dataType: 'json',
                    //data: JSON.stringify(obj),
                    data: file,
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        alert('No internet connection? Check your settings');
                        console.log(JSON.stringify(XMLHttpRequest));
                        console.log(JSON.stringify(textStatus));
                        console.log(JSON.stringify(errorThrown));
                    },
                    success: function (data) {
                        alert("siip");
                        console.log(JSON.stringify(data));
                    }
                });

}

</script>


    </head>
    <body>
        <div data-role="page" id="page1">
            <div data-theme="a" data-role="header">
                <h3>
                    Mi Chancla
                </h3>
            </div>
            <div data-role="content">
                <div>
                    <p>
                        <strong>
                            We love chanclas!
                            <br />
                            <br />
                        </strong>
                    </p>
                </div>
                <div>
                    <p>
                        Upload a photo of your chanclas, or a friends, or any chancla you see around.
                        <br />
                    </p>
                </div>
                <input type="button" class="send-image" value="camera" />
                <input type="button" class="send-image" value="library" />
                <hr />
                <input type="button" class="test" value="test" />

                <input type="file" name="tobase64file" class="filefield" />
            </div>
        </div>



        <div data-role="page" id="chancla_details">
            <div data-theme="a" data-role="header">
                <h3>
                    Review submition
                </h3>
            </div>
            <div data-role="content">



                <form action="#chancla_details" method="POST">
                    <div data-role="fieldcontain">
                        <fieldset data-role="controlgroup">
                            <label for="description">
                                Description
                            </label>
                            <input id="description" placeholder="Description..." value="" type="text" />
                        </fieldset>
                    </div>
                <div>
                    <img src="" id="image" alt="image" style="width: 100%;" />
                </div>

                    <div data-role="fieldcontain">
                        <label for="category">
                            Category
                        </label>
                        <select name="category" id="category">
                            <option value="casual">
                                Casual
                            </option>
                            <option value="fun">
                                Fun
                            </option>
                            <option value="style">
                                Style
                            </option>
                            <option value="other">
                                Other
                            </option>
                        </select>
                    </div>
                    <input type="submit" data-theme="e" value="Send" />
                </form>
            </div>
        </div>

    </body>
    
</html>
